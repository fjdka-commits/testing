<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë Œì§€ ì£¼ì‹íšŒì‚¬ ì„ì§ì› ì‡¼í•‘ëª°</title>
    <!-- ì›¹ì‚¬ì´íŠ¸ ì•„ì´ì½˜(íŒŒë¹„ì½˜) ìµœì¢… ì ìš© -->
    <link rel="icon" type="image/png" href="icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* í°íŠ¸ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: #f7f7f7; /* ë°°ê²½ìƒ‰ì„ ë°ì€ íšŒìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            color: #333;
        }

        /* ìƒí’ˆ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .product-card {
            cursor: pointer;
            /* scale íŠ¸ëœì§€ì…˜ ì¶”ê°€ */
            transition: transform 0.2s, box-shadow 0.2s, scale 0.2s; 
            background-color: #fff;
            border: 1px solid #eee; 
            box-shadow: none !important; 
            overflow: hidden;
            text-align: left;
        }
        .product-card:hover {
            transform: translateY(-3px);
            scale: 1.03; /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì‚´ì§ í™•ëŒ€ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        .product-image-container {
            background-color: #f5f5f5; 
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .product-image {
            width: 100%;
            height: 250px;
            object-fit: contain; 
        }
        
        /* ìƒí’ˆ ì •ë³´ ì˜ì—­ ìŠ¤íƒ€ì¼ (ë†’ì´ í™•ì¥ ê¸°ëŠ¥ ì œê±°) */
        .product-info {
            padding: 1rem;
            position: relative;
            /* ë†’ì´ ì œì–´ ê´€ë ¨ ì†ì„± ì œê±° */
            overflow: hidden; 
        }

        /* ìƒí’ˆ ì„¤ëª… í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ (ì¤„ ìˆ˜ ì œí•œ ì œê±° ë° ì˜¤ë²„í”Œë¡œìš° ê´€ë¦¬) */
        .product-description {
            font-size: 0.875rem; 
            color: #9ca3af; 
            margin-top: 0.5rem; 
            
            /* í…ìŠ¤íŠ¸ê°€ ì˜ë¦¬ì§€ ì•Šë„ë¡ ì¤„ ìˆ˜ ì œí•œ ì œê±° */
            display: block; 
            overflow: visible; 
            word-break: break-word; 
            height: auto; 
        }
        
        /* ì´ë¦„ê³¼ ê°€ê²©ì€ í•­ìƒ ì˜¨ì „íˆ ë³´ì´ë„ë¡ ì„¤ì • */
        .product-name, .product-price {
            display: block !important; 
            overflow: visible !important;
            word-break: break-word;
        }


        /* íŒì—… ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none; 
            position: fixed;
            z-index: 50; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7); 
        }

        .modal-content {
            background-color: #fff;
            margin: 15vh auto; 
            padding: 30px;
            border-radius: 8px;
            max-width: 400px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #checkout-btn {
            background-color: #1a1a1a; 
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #checkout-btn:hover:not(:disabled) {
            background-color: #555;
        }
        #checkout-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ CSS */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3); /* ë°°ê²½ì— ê°€ê¹Œìš´ ìƒ‰ */
            border-left-color: #fff; /* íšŒì „í•˜ëŠ” ë¶€ë¶„ */
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
           /* ğŸ¬ í˜¸ëŸ¬ 404 ì—ëŸ¬ ìŠ¤íƒ€ì¼ */
        .horror-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: flicker 0.1s infinite;
        }

        .tv-noise {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(...);
            animation: noise 0.5s infinite;  /* 0.2ì´ˆ â†’ 0.5ì´ˆ (ëŠë¦¬ê²Œ) */
            opacity: 0.1;  /* 0.3 â†’ 0.1 (ë” íˆ¬ëª…í•˜ê²Œ) */
        }

        @keyframes noise {
            0% { transform: translate(0, 0); }
            10% { transform: translate(-5%, -5%); }
            20% { transform: translate(-10%, 5%); }
            30% { transform: translate(5%, -10%); }
            40% { transform: translate(-5%, 15%); }
            50% { transform: translate(-10%, 5%); }
            60% { transform: translate(15%, 0); }
            70% { transform: translate(0, 10%); }
            80% { transform: translate(-15%, 0); }
            90% { transform: translate(10%, 5%); }
            100% { transform: translate(5%, 0); }
        }

        @keyframes flicker {
            0% { opacity: 1; }
            50% { opacity: 0.95; }
            100% { opacity: 1; }
        }

        .error-code {
            font-size: 120px;
            font-weight: bold;
            color: #ff8c00;
            text-shadow: 
                0 0 10px #ff8c00,
                0 0 20px #ff8c00,
                0 0 30px #ff8c00,
                0 0 40px #ff8c00;
            animation: glitch 1s infinite;
            z-index: 10;
            font-family: 'Courier New', monospace;
        }

        @keyframes glitch {
            0%, 20%, 40%, 60%, 80%, 100% {
                opacity: 1;
            }
            10%, 30%, 50%, 70%, 90% {
                opacity: 0.5;
            }
        }

        .error-message {
            font-size: 24px;
            color: #fff;
            margin-top: 30px;
            text-align: center;
            animation: blink 1.5s infinite;
            z-index: 10;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 10px #fff;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .static-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            animation: scan 8s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }
    </style>
</head>
<body>
  <!-- ğŸ¬ í˜¸ëŸ¬ 404 ì—ëŸ¬ í™”ë©´ -->
    <div class="horror-overlay">
        <div class="tv-noise"></div>
        <div class="static-lines"></div>
        <div class="error-code">Thanks for playing</div>
        <div class="error-message">
            STORE TEMPORARILY UNAVAILABLE<br>
            ìƒì ì´ ì¼ì‹œì ìœ¼ë¡œ ì´ìš© ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤<br>
            <span style="font-size: 16px; margin-top: 10px; display: block;">
                [ SYSTEM ERROR - CONTACT ADMINISTRATOR ]
            </span>
        </div>
    </div>

    <!-- ì›ë˜ í—¤ë” (ìˆ¨ê²¨ì§) -->
    <header class="bg-white border-b border-gray-200">   

    <!-- í—¤ë” - ê¹”ë”í•˜ê³  ë¯¸ë‹ˆë©€í•œ ë””ìì¸ --><header class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto flex justify-between items-center py-4 px-4 sm:px-6 lg:px-8">
            <h1 class="text-xl font-semibold tracking-widest text-gray-900 uppercase">
                 Orange Company
            </h1>
            <nav class="hidden sm:block">
                <a href="https://docs.google.com/document/d/1fp488RKYSdy5zricQRpxKLr5qDdRgTRZ0dJZ1BnWTkQ/edit?usp=sharing" target="_blank" class="text-sm text-gray-500 hover:text-gray-900 mx-3">HOME</a>
                <a href="#" class="text-sm text-gray-900 font-medium mx-3">SHOP</a>
                <a href="https://x.com/orange_1nc" target="_blank" class="text-sm text-gray-500 hover:text-gray-900 mx-3">CONTACT</a>
            </nav>
            <div class="flex items-center">
                <!-- ì¥ë°”êµ¬ë‹ˆ ì•„ì´ì½˜ ë° ì¹´ìš´íŠ¸ --><div class="relative cursor-pointer hover:text-gray-900 text-gray-500" onclick="openCartModal()">
                    <!-- Shopping Bag Icon (Lucide) --><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
                        <path d="M3 6h18"></path>
                        <path d="M16 10a4 4 0 0 1-8 0"></path>
                    </svg>
                    <!-- Cart Count Indicator --><span id="cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">
                        0
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ --><main class="max-w-7xl mx-auto mt-10 px-4 sm:px-6 lg:px-8">
        <!-- ìƒí’ˆ ë¶„ë¥˜ í—¤ë” --><div class="mb-8 pb-4 border-b border-gray-300">
            <h2 class="text-4xl font-light tracking-wide mb-2">SHOP LIST</h2>
            <p class="text-sm text-gray-500">prepared just for you, ONE DAY ONE ORANGE</p>
        </div>

        <!-- ìƒí’ˆ ëª©ë¡ --><div id="product-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <!-- ìƒí’ˆ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. --></div>
    </main>

    <!-- ì¥ë°”êµ¬ë‹ˆ/ì²´í¬ì•„ì›ƒ íŒì—… ì°½ (ëª¨ë‹¬) --><div id="cart-checkout-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="cart-modal-title">
        <div class="modal-content !max-w-lg">
            <span class="close-btn" onclick="closeCartModal()">&times;</span>
            <h2 id="cart-modal-title" class="text-2xl font-medium mb-6 text-gray-900 text-center">SHOPPING CART</h2>
            
            <div id="cart-items-container" class="max-h-60 overflow-y-auto pr-2">
                <!-- Cart items rendered here --><p id="empty-cart-message" class="text-center text-gray-500 py-8 hidden">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
            </div>

            <div class="mt-6 pt-4 border-t border-gray-200">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-medium text-gray-900">ì´ ê²°ì œ ê¸ˆì•¡:</span>
                    <span id="cart-total-value" class="text-xl font-bold text-gray-900">0 P</span>
                </div>

                <div class="mb-6 text-left">
                    <!-- 2. êµ¬ë§¤ì ì´ë¦„ ëŒ€ì‹  4ìë¦¬ ì§ì› ì½”ë“œë¡œ ë³€ê²½ --><label for="checkout-employee-code" class="block text-sm font-medium text-gray-700 mb-2">
                        ì§ì› ì½”ë“œ (4ìë¦¬ ìˆ«ì, ì˜êµ¬ ì €ì¥):
                    </label>
                    <input type="tel" id="checkout-employee-code" placeholder="4ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1004)" 
                        class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-sm focus:ring-gray-700 focus:border-gray-700 sm:text-sm"
                        maxlength="4" inputmode="numeric" pattern="[0-9]{4}">
                </div>

                <button id="checkout-btn" 
                        class="w-full py-3 px-4 rounded-sm text-white font-medium shadow-sm bg-gray-900 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black" disabled>
                    <!-- ë¡œë”© ìŠ¤í”¼ë„ˆì™€ ë²„íŠ¼ í…ìŠ¤íŠ¸ê°€ í•¨ê»˜ í‘œì‹œë¨ -->
                    <span id="checkout-loading-spinner" class="spinner hidden"></span>
                    <span id="checkout-btn-text">ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘...</span>
                </button>

                <!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ --><p id="checkout-error-message" class="text-red-500 text-sm mt-3 hidden text-center">ì§ì› ì½”ë“œ(4ìë¦¬ ìˆ«ì)ë¥¼ ì…ë ¥í•´ì•¼ êµ¬ë§¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK Import (type="module" í•„ìˆ˜) - ë°±ì—”ë“œ ì‹œìŠ¤í…œ ì¬ì‘ì„± -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
    getFirestore, 
    addDoc, 
    collection,
    setDoc,
    doc
} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // **FIREBASE CONFIGURATION**
        // í™˜ê²½ ë³€ìˆ˜ê°€ ì œê³µë˜ì§€ ì•Šì€ ê²½ìš°, ë””ë²„ê¹…ì„ ìœ„í•´ í•˜ë“œì½”ë”©ëœ CONFIGë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        const providedConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyCpTsxI2iMBNI_iYxhhuzu8mmKt_nAPNq0",
            authDomain: "test-b49ef.firebaseapp.com",
            projectId: "test-b49ef",
            storageBucket: "test-b49ef.firebasestorage.app",
            appId: "1:250359349916:web:43411fddcc96a59010e359"
        };

        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        // ì•± IDë¥¼ íŒŒì‹±í•˜ê±°ë‚˜, í•˜ë“œì½”ë”©ëœ ê²½ìš° projectIdë¥¼ ì‚¬ìš©
        const appId = providedConfig.appId.split(':')[2] || providedConfig.projectId; 

        // Firebase ì´ˆê¸°í™” ë° ìƒíƒœ ê´€ë¦¬ ëª¨ë“ˆ (ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì•ˆì „í•˜ê²Œ í˜¸ì¶œ)
        window.getFirebaseModule = () => {
            return new Promise(async (resolve, reject) => {
                let db = null;
                let userId = null;
                const authTimeout = 10000; // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
                
                try {
                    const app = initializeApp(providedConfig);
                    db = getFirestore(app);
                    const auth = getAuth(app);
                    
                    let authResolved = false;
                    
                    // ì¸ì¦ ì™„ë£Œë¥¼ ê¸°ë‹¤ë¦¬ëŠ” Promise
                    const authPromise = new Promise(authResolve => {
                        const unsubscribe = onAuthStateChanged(auth, async (user) => {
                            unsubscribe(); // í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ êµ¬ë… í•´ì œ

                            if (user) {
                                userId = user.uid;
                                authResolved = true;
                                authResolve();
                            } else {
                                try {
                                    if (initialAuthToken) {
                                        const userCredential = await signInWithCustomToken(auth, initialAuthToken);
                                        userId = userCredential.user.uid;
                                    } else {
                                        const userCredential = await signInAnonymously(auth);
                                        userId = userCredential.user.uid;
                                    }
                                    authResolved = true;
                                    authResolve();
                                } catch (error) {
                                    console.error("Firebase Auth failed (anonymous/custom token):", error);
                                    userId = crypto.randomUUID(); 
                                    authResolved = true;
                                    authResolve();
                                }
                            }
                        });
                    });
                    
                    // ì¸ì¦ Promiseì™€ íƒ€ì„ì•„ì›ƒ Promiseë¥¼ ê²½ìŸì‹œí‚´
                    const timeoutPromise = new Promise((_, rejectTimeout) => 
                        setTimeout(() => rejectTimeout(new Error("Auth Timeout")), authTimeout)
                    );
                    
                    // ë‘ Promise ì¤‘ í•˜ë‚˜ê°€ ì™„ë£Œë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¼
                    await Promise.race([authPromise, timeoutPromise]);
                    
                    if (!authResolved) {
                         throw new Error("Auth process incomplete due to timeout.");
                    }
                    
                    console.log("SUCCESS: Firebase Auth and Firestore setup complete. User ID:", userId);
                    
                    // ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‚¬ìš©í•  ê°ì²´ì™€ í•¨ìˆ˜ë¥¼ ë°˜í™˜
                    resolve({
                        db,
                        userId,
                        appId,
                        addDoc,
                        collection,
                        setDoc,
                        doc
                    });
                    
                } catch (error) {
                    console.error("FATAL ERROR in Firebase Module Init:", error);
                    reject(error);
                }
            });
        };
    </script>

    <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ (ëª¨ë“  ë¡œì§ì„ ë¹„ë™ê¸° IIFEë¡œ ë˜í•‘í•˜ì—¬ Firebase ì¢…ì†ì„± ì²˜ë¦¬) -->
    <script>
        // "alert()" ëŒ€ì‹  ì‚¬ìš©í•  ê°„ë‹¨í•œ ëª¨ë‹¬ ë©”ì‹œì§€ í•¨ìˆ˜
        function showMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'fixed top-4 right-4 bg-gray-900 text-white p-4 rounded-md shadow-xl z-50 transition duration-300 ease-in-out';
            messageBox.textContent = message;
            document.body.appendChild(messageBox);
            setTimeout(() => {
                messageBox.remove();
            }, 3000);
        }

        // íŠ¹ì • ëª¨ë‹¬ì˜ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ëŠ” ë²”ìš© í•¨ìˆ˜
        function showErrorMessage(message, elementId) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
            }
        }

        // íŠ¹ì • ëª¨ë‹¬ì˜ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ìˆ¨ê¸°ëŠ” ë²”ìš© í•¨ìˆ˜
        function hideErrorMessage(elementId) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.classList.add('hidden');
            }
        }
        
        // --- Firebase ìƒíƒœ ë° ê°ì²´ ---
        let firebaseModule = { db: null, userId: null, appId: null, addDoc: null, collection: null };
        let isFirebaseConnected = false; 

        // 1. ìƒí’ˆ ë°ì´í„° ì •ì˜ (ë‚´ìš© ìœ ì§€)
        const products = [
            { 
                id: 1, 
                name: "ì˜¤ë Œì§€ì£¼ìŠ¤", 
                description: "ì–´ë””ì„œë‚˜ ë³¼ ìˆ˜ ìˆëŠ” í”í•œ ì˜¤ë Œì§€ ì£¼ìŠ¤. ì„¤íƒ• í•¨ìœ ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤. ì˜¤ì—¼ë„ -10%", 
                price: "1,000 P",
                image: "https://i.postimg.cc/CKNySnqb/image2.png" 
            },
            { 
                id: 2, 
                name: "ë‹¨ë°±ì§ˆ ë°”", 
                description: "ìµìˆ™í•œ(â€¦) ë¹„ì£¼ì–¼ì˜ ë‹¨ë°±ì§ˆ ë°”ì…ë‹ˆë‹¤. ì—­ê²¨ìš¸ ì •ë„ë¡œ ê³ ì†Œí•œ ë§›ì´ ë‚©ë‹ˆë‹¤. ì˜¤ì—¼ë„ -20%!", 
                price: "2,000 P",
                image: "https://i.postimg.cc/Hs4GdW7J/danbaegjilba.png" 
            },
            { 
                id: 3, 
                name: "í”„ë¦¬ë¯¸ì—„ ì˜¤ë Œì§€ì£¼ìŠ¤", 
                description: "ë¬´ë ¤ ì§„ì§œ ì˜¤ë Œì§€ì¦™ì´ 1%ë‚˜ í•¨ìœ ëœ í”„ë¦¬ë¯¸ì—„ ì˜¤ë Œì§€ ì£¼ìŠ¤ì…ë‹ˆë‹¤. ì›°ëª¬íŠ¸ì˜ íš¨ì ìƒí’ˆ. ì˜¤ì—¼ë„ -30%!", 
                price: "3,000 P", 
                image: "https://i.postimg.cc/LsTd2g1t/image3.png" 
            },
            { 
                id: 4, 
                name: "ë³´í˜¸ë³µ", 
                description: "ë¹„ì‹¼ ë³´í˜¸ë³µ. í•œë²ˆì˜ íƒì‚¬ì—ì„œ ìµœëŒ€ 40%ê¹Œì§€ ì˜¤ì—¼ë˜ëŠ” ê²ƒì„ ë§‰ì•„ì¤ë‹ˆë‹¤. ìœ ê°ìŠ¤ëŸ½ì§€ë§Œ ì¼íšŒìš©ì…ë‹ˆë‹¤.", 
                price: "5,000 P", 
                image: "https://i.postimg.cc/SR9GkKTJ/bohobog.png" 
            },
            { 
                id: 5, 
                name: "ë§ë‘ì´", 
                description: "ê·€ì—½ê³  íë¬¼ê±°ë¦¬ëŠ” ë§ë‘ì´ì…ë‹ˆë‹¤. ê°€ì§€ê³  ìˆëŠ” ì‚¬ëŒì˜ ì˜¤ì—¼ë„ë§Œí¼ ê²€ê²Œ ë¬¼ë“¤ë©°, ìƒëŒ€ì™€ êµí™˜í•´ ì˜¤ì—¼ë„ë¥¼ ë§ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•œ ë²ˆ ì‚¬ìš©í•˜ë©´ íë¬¼íë¬¼í•˜ê²Œ ë…¹ì•„ ì‚¬ë¼ì§‘ë‹ˆë‹¤!", 
                price: "3,000 P", 
                image: "https://i.postimg.cc/vHm7H34C/mallang-i.png" 
            },
            { 
                id: 6, 
                name: "ì˜¤ì—¼ë„ ì¸¡ì •ê¸°", 
                description: "ì¼íšŒìš© ì˜¤ì—¼ë„ ì¸¡ì •ê¸°ì…ë‹ˆë‹¤. íŠ¹ì •í•œ ì¥ì†Œì— ëŒ€ê³  ì‚¬ìš©í•˜ë©´ ì˜¤ì—¼ë„ê°€ ì–¼ë§ˆë‚˜ ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•­ìƒ ì˜¤ì—¼ë„ë¥¼ ì²´í¬í•©ì‹œë‹¤!", 
                price: "2,500 P", 
                image: "https://i.postimg.cc/BbR2zGJ0/oyeomdo-cheugjeong-gi.png" 
            },
            { 
                id: 7, 
                name: "ë ˆì´ë” íƒì§€ê¸°", 
                description: "ì¼íšŒìš© ë ˆì´ë” íƒì§€ê¸°ì…ë‹ˆë‹¤. ì‚¬ìš©í•  ê²½ìš° ê·¸ ì¥ì†Œ ì´ë‚´ì— ìˆëŠ” ì¤‘ìš”í•œ ì¡°ì‚¬ í’ˆëª©ì˜ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì¤ë‹ˆë‹¤!", 
                price: "4,000 P", 
                image: "https://i.postimg.cc/8czyGD83/leideocheugjeong-gi.png" 
            },
            { 
                id: 8, 
                name: "ìš°ì‚°", 
                description: "ë¬´ì—‡ì´ë“  ë§‰ì•„ ì¤ë‹ˆë‹¤! ë¹—ë°©ìš¸, íŠ€ê¸´ í”¼, ì˜¤ì—¼ëœ ë¬¼ê¹Œì§€!", 
                price: "500 P", 
                image: "https://i.postimg.cc/KvJ2tvcw/usan.png" 
            },
            { 
                id: 9, 
                name: "í…Œë”” ì¸í˜•", 
                description: "ë‹¹ì‹ ì˜ ì¹œì ˆí•œ ì¹œêµ¬, í…Œë””ë² ì–´ ì¸í˜•ì…ë‹ˆë‹¤. í™•ì • ì‹¤ì¢… ìœ„ê¸°ì— ë†“ì¸ ë™ë£Œ í•œ ëª… ëŒ€ì‹  í…Œë””ë¥¼ í¬ìƒì‹œí‚µë‹ˆë‹¤. ì°°ë¦¬ëŠ” ì˜ì›íˆ ë‹¹ì‹ ì˜ ì¹œêµ¬ì¼ ê²ƒì…ë‹ˆë‹¤.", 
                price: "10,000 P", 
                image: "https://i.postimg.cc/2y15gb50/gomdol-i.png" 
            },
            { 
                id: 10, 
                name: "ì˜¤ë Œì§€ ë¼ë””ì˜¤ì— ì‚¬ì—° ë³´ë‚´ê¸°", 
                description: "ì—¬ëŸ¬ë¶„ì´ ì§ì ‘ ë³´ë‚´ì£¼ì‹  ì‚¬ì—°ì„ ì‚¬ë‚´ ë°©ì†¡ìœ¼ë¡œ ë“¤ë ¤ë“œë¦½ë‹ˆë‹¤! ì˜¤ë Œì§€ ë¼ë””ì˜¤ ë‰´-ìŠ¤!", 
                price: "500 P",
                salePrice: "200 P",  // â­ ì„¸ì¼ ê°€ê²© ì¶”ê°€
                image: "https://i.postimg.cc/2S7BQWLV/sayeonbonaegi.png" 
            },
            { 
                id: 11, 
                name: "O-Oì˜ ëœë¤ë°•ìŠ¤", 
                description: "ìš°ë¦¬ì˜ ë§ˆìŠ¤ì½”íŠ¸ ë¡œë´‡ O-Oê°€ ëŒë ¤ì£¼ëŠ” 2,000p ëœë¤ ë°•ìŠ¤. ìƒì  ì•„ì´í…œ ì¤‘ ëœë¤í•œ ë¬¼ê±´ì„ ì¦ì •! * íˆë“  ì•„ì´í…œ ì¡´ì¬ *", 
                price: "2,000 P", 
                image: "https://i.postimg.cc/RhZthZZT/jjeobseun.png" 
            }
        ];

        // --- DOM ìš”ì†Œ ì°¸ì¡° ---
        const productList = document.getElementById('product-list');
        const cartModal = document.getElementById('cart-checkout-modal');
        const cartItemsContainer = document.getElementById('cart-items-container');
        const cartTotalValue = document.getElementById('cart-total-value');
        const cartCountIndicator = document.getElementById('cart-count');
        const checkoutEmployeeCodeInput = document.getElementById('checkout-employee-code');
        const checkoutBtn = document.getElementById('checkout-btn');
        const checkoutBtnText = document.getElementById('checkout-btn-text');
        const checkoutLoadingSpinner = document.getElementById('checkout-loading-spinner');
        const checkoutErrorMessageId = 'checkout-error-message';
        const emptyCartMessage = document.getElementById('empty-cart-message');
        
       // ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ
        let cart = []; 

        // â­ ì§ì› ì½”ë“œ â†’ ìºë¦­í„° ì´ë¦„ ë§¤ì¹­ (24ëª… ì •ë³´)
        const employeeNames = {
            "1111": "íŒ€ì¥",
            "2222": "ë¶€íŒ€ì¥",
            "8513": "ì—ë¸”ë¦° ë¨¸í”¼",
            "8558": "ì¹¼ë¦¬ ë§ˆí‹´",
            "8333": "í”¼ë¹„ í™€ëŸ¬ì›¨ì´",
            "8924": "íœ´ ì™€ì´ì¦ˆë¨¼",
            "8312": "í—ˆìƒê· ",
            "8915": "ë…¸ì•„ í‹¸ë§¨",
            "8014": "í‚¬ë¦¬ì–¸ ì œë°ë‹¤ì´ì–´",
            "8567": "ë ˆë‚˜ ì™€ê·¸ë„ˆ",
            "8419": "ê¹€ ì§„",
            "8231": "ì½œëŸ¬ í•˜ì´ëœë“œ",
            "8859": "ì•„ë‚˜ìŠ¤íƒ€ìƒ¤ ëª¨ë¡œì¦ˆ",
            "8018": "ì¼€ì¼ ìŠ¤íŠœì–´ë“œ",
            "8712": "ë‹ˆì½œë¼ìŠ¤ ë‚˜ë°”ë¡œ",
            "8853": "ë°€ë¼ ì•ˆ",
            "8703": "ë‹ ë°ì´ë¹„ìŠ¤",
            "8216": "ëª¨ë¦¬ìŠ¤ ì—ë°˜ìŠ¤",
            "8844": "ë ˆë…¸ë¼ ë³´ë°ì»¤",
            "8309": "ë¦¬ì•„ íŒ¬íŠ¼",
            "8754": "ê²Œì˜¤ë°˜ ë”œíŠ¼",
            "8277": "ì• ì»¤ í‚¤ë„ˆë“œ",
            "8499": "ê±°ìŠ¤ ë°°ëŸ¿",
            "8026": "ë§¥ ì  í‚¨ìŠ¤",
            "8966": "ì œì´í¬ ì½œë¦°ìŠ¤",
            "8416": "ë©”ì´ì–´ ì›"
        };

        // Helper: P(í¬ì¸íŠ¸) ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜
        function parsePrice(priceString) {
            return parseInt(priceString.replace(' P', '').replace(/,/g, ''), 10);
        }
        
        // Helper: ì¹´íŠ¸ ì•„ì´í…œ ìˆ˜ ì—…ë°ì´íŠ¸
        function updateCartCount() {
            cartCountIndicator.textContent = cart.length;
        }

        // Firebase ì—°ê²° ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ê³¼ ì „ì—­ ìƒíƒœ ì—…ë°ì´íŠ¸
        function setFirebaseConnectionStatus(connected) {
            isFirebaseConnected = connected;
            hideErrorMessage(checkoutErrorMessageId);

            if (connected) {
                checkoutBtn.disabled = (cart.length === 0);
                checkoutBtnText.textContent = "ì¥ë°”êµ¬ë‹ˆ ì „ì²´ êµ¬ë§¤ í™•ì •";
                checkoutLoadingSpinner.classList.add('hidden');
            } else {
                checkoutBtn.disabled = true;
                checkoutLoadingSpinner.classList.remove('hidden');
                checkoutBtnText.textContent = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘...";
            }
        }
        
        // Firebase ì—°ê²° ì´ˆê¸°í™” ë° ìƒíƒœ ì—…ë°ì´íŠ¸ ë¡œì§ (ìƒˆë¡œìš´ ëª¨ë“ˆ ê¸°ë°˜)
        async function initializeFirebaseConnection() {
            // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
            setFirebaseConnectionStatus(false);
            
            try {
                // window.getFirebaseModule()ì„ í†µí•´ Promise ê¸°ë°˜ìœ¼ë¡œ Firebase ê°ì²´ë¥¼ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜´
                const module = await window.getFirebaseModule();
                firebaseModule = module;
                
                setFirebaseConnectionStatus(true);
                console.log("SUCCESS: Firebase module successfully loaded and authenticated.");
                
                // **ìˆ˜ì •ëœ ë¡œì§: Firebase ì—°ê²° ì„±ê³µ í›„ ìƒí’ˆ ë Œë”ë§ ì‹œì‘**
                renderProducts(); 
                
            } catch (error) {
                console.error("FATAL ERROR: Firebase connection failed.", error);
                
                // ì—°ê²° ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ì„ ì¬ì—°ê²° ì‹œë„ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
                checkoutBtn.disabled = false; // ì¬ì‹œë„ ë²„íŠ¼ì€ í™œì„±í™”
                checkoutLoadingSpinner.classList.add('hidden');
                checkoutBtnText.textContent = "ì¬ì—°ê²° ì‹œë„";
                
                // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                showErrorMessage('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¬ì—°ê²°ì„ ì‹œë„í•˜ê±°ë‚˜ ìƒˆë¡œê³ ì¹¨ í•´ ì£¼ì„¸ìš”.', checkoutErrorMessageId);
                
                // ì—°ê²° ì‹¤íŒ¨ ì‹œ ë¹ˆ ìƒí’ˆ ëª©ë¡ í‘œì‹œ (í˜¹ì‹œ ëª¨ë¥¼ ì˜¤ë¥˜ ëŒ€ë¹„)
                productList.innerHTML = '<p class="text-center text-gray-500 py-20 col-span-full">ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
            }
        }

        // ìƒí’ˆ ëª©ë¡ ë™ì  ìƒì„± í•¨ìˆ˜
        function renderProducts() {
            productList.innerHTML = ''; 
            products.forEach(product => {
                const card = document.createElement('div');
                card.classList.add('product-card', 'rounded-lg'); 
                card.setAttribute('data-product-id', product.id);

                // ê°€ê²© í‘œì‹œ ë¡œì§
            let priceHTML = '';
            if (product.salePrice) {
            // ì„¸ì¼ ì¤‘: ì·¨ì†Œì„  + ì„¸ì¼ ê°€ê²©
            priceHTML = `
            <p class="product-price text-base mb-1">
            <span style="text-decoration: line-through; color: #9ca3af; margin-right: 8px;">${product.price}</span>
            <span style="color: #f97316; font-weight: bold;">${product.salePrice}</span>
            </p>
            `;
            } else {
                // ì¼ë°˜ ê°€ê²©
            priceHTML = `<p class="product-price text-base font-semibold text-gray-900 mb-1">${product.price}</p>`;
            }

            card.innerHTML = `
            <div class="product-image-container rounded-t-lg">
        <img src="${product.image}" alt="${product.name}" class="product-image">
    </div>
    <div class="product-info">
        <p class="product-name text-lg font-medium text-gray-900 mb-1">${product.name}</p> 
        ${priceHTML}
        <p class="product-description text-sm text-gray-400 mt-2">${product.description}</p> 
    </div>
        `;
                
                card.addEventListener('click', () => {
                    addToCart(product);
                });

                productList.appendChild(card);
            });
        }
        
        // ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸° (ë°”ë¡œ ë‹´ê¸° ê¸°ëŠ¥)
        function addToCart(product) {
    const existingItem = cart.find(item => item.id === product.id);
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        // ì„¸ì¼ ê°€ê²©ì´ ìˆìœ¼ë©´ ì„¸ì¼ ê°€ê²© ì ìš©
        const itemToAdd = { ...product, quantity: 1 };
        if (product.salePrice) {
            itemToAdd.price = product.salePrice;
        }
        cart.push(itemToAdd);
    }
    updateCartCount();
    showMessage(`âœ… ${product.name}ì´(ê°€) ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤. (ìˆ˜ëŸ‰: ${existingItem ? existingItem.quantity : 1})`);
}
        
        // ì¥ë°”êµ¬ë‹ˆ ì´ ê¸ˆì•¡ ê³„ì‚°
        function calculateCartTotal() {
            return cart.reduce((total, item) => {
                return total + (parsePrice(item.price) * item.quantity);
            }, 0);
        }

        // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ë Œë”ë§
        function renderCartItems() {
            cartItemsContainer.innerHTML = '';
            
            // Firebase ì—°ê²° ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            if (isFirebaseConnected) {
                checkoutBtn.disabled = (cart.length === 0);
            } else if (checkoutBtnText.textContent === "ì¬ì—°ê²° ì‹œë„") {
                checkoutBtn.disabled = false;
            } else {
                 checkoutBtn.disabled = true;
            }
            
            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                cartTotalValue.textContent = '0 P';
                checkoutBtn.disabled = true;
                return;
            }
            emptyCartMessage.classList.add('hidden');
            
            cart.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center justify-between p-3 border-b border-gray-100 last:border-b-0';
                
                const totalItemPrice = parsePrice(item.price) * item.quantity;

                itemDiv.innerHTML = `
                    <div class="flex items-center flex-1">
                        <img src="${item.image}" alt="${item.name}" class="w-10 h-10 object-contain mr-4 bg-gray-50 rounded-sm">
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate">${item.name}</p>
                            <p class="text-xs text-gray-500">${item.price} x ${item.quantity} = ${totalItemPrice.toLocaleString('ko-KR')} P</p>
                        </div>
                    </div>
                    <button class="text-red-500 hover:text-red-700 text-sm py-1 px-2 rounded hover:bg-red-50" onclick="removeItemFromCart(${index})">
                        ì‚­ì œ
                    </button>
                `;
                cartItemsContainer.appendChild(itemDiv);
            });
            
            // ì´í•© ì—…ë°ì´íŠ¸
            cartTotalValue.textContent = `${calculateCartTotal().toLocaleString('ko-KR')} P`;
        }
        
        // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ì‚­ì œ
        window.removeItemFromCart = (index) => {
            cart.splice(index, 1);
            renderCartItems();
            updateCartCount();
            showMessage('Item removed from cart.');
        }

        // ì¥ë°”êµ¬ë‹ˆ íŒì—… ì—´ê¸°/ë‹«ê¸°
        window.openCartModal = () => {
            renderCartItems();
            checkoutEmployeeCodeInput.value = '';
            hideErrorMessage(checkoutErrorMessageId);
            cartModal.style.display = 'block';
            
            // Firebase ì—°ê²° ìƒíƒœì— ë”°ë¼ UI ì—…ë°ì´íŠ¸
            if (isFirebaseConnected) {
                checkoutBtnText.textContent = "ì¥ë°”êµ¬ë‹ˆ ì „ì²´ êµ¬ë§¤ í™•ì •";
                checkoutLoadingSpinner.classList.add('hidden');
                checkoutBtn.disabled = (cart.length === 0);
            } else {
                if (checkoutBtnText.textContent === "ì¬ì—°ê²° ì‹œë„") {
                     checkoutBtn.disabled = false;
                     checkoutLoadingSpinner.classList.add('hidden');
                } else {
                     // ì—°ê²° ì¤‘ì´ê±°ë‚˜ ì´ˆê¸° ìƒíƒœ
                     checkoutBtn.disabled = true;
                     checkoutBtnText.textContent = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘...";
                     checkoutLoadingSpinner.classList.remove('hidden');
                }
            }
        }

        window.closeCartModal = () => {
            cartModal.style.display = 'none';
        }

        // íŒì—… ì™¸ë¶€ í´ë¦­ ë° ë‹«ê¸° ë²„íŠ¼ ì„¤ì •
        window.onclick = (event) => {
            if (event.target == cartModal) {
                closeCartModal();
            }
        };

        // ì¥ë°”êµ¬ë‹ˆ ì „ì²´ êµ¬ë§¤ í™•ì • (ì²´í¬ì•„ì›ƒ) ì´ë²¤íŠ¸
        checkoutBtn.addEventListener('click', async () => {
            
            // ì¬ì—°ê²° ì‹œë„ ë²„íŠ¼ì¼ ê²½ìš°
            if (checkoutBtnText.textContent === "ì¬ì—°ê²° ì‹œë„") {
                // ë²„íŠ¼ í…ìŠ¤íŠ¸ì™€ ìƒíƒœë¥¼ ë‹¤ì‹œ ì´ˆê¸° ì—°ê²° ìƒíƒœë¡œ ë˜ëŒë¦¬ê³  ì¬ì‹œë„
                initializeFirebaseConnection();
                return;
            }
            
            const employeeCode = checkoutEmployeeCodeInput.value.trim();

            if (!isFirebaseConnected) {
                 showErrorMessage('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', checkoutErrorMessageId);
                 return;
            }

            if (cart.length === 0) {
                 showErrorMessage('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.', checkoutErrorMessageId);
                 return;
            }

            // ì§ì› ì½”ë“œ ìœ íš¨ì„± ê²€ì‚¬ (4ìë¦¬ ìˆ«ì)
            const codeRegex = /^\d{4}$/;
            if (!codeRegex.test(employeeCode)) {
                showErrorMessage('ì§ì› ì½”ë“œ(4ìë¦¬ ìˆ«ì)ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì•¼ êµ¬ë§¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', checkoutErrorMessageId);
                return;
            }

            hideErrorMessage(checkoutErrorMessageId);
            await checkoutFromCart(employeeCode); // ì§ì› ì½”ë“œë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬
        });

        // ì—”í„° í‚¤ ì´ë²¤íŠ¸ (ì¥ë°”êµ¬ë‹ˆ êµ¬ë§¤)
        checkoutEmployeeCodeInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); 
                checkoutBtn.click();
            }
        });

        // Firebase êµ¬ë§¤ ì €ì¥ ë¡œì§
        async function savePurchase(product, employeeCode, transactionType) {
            const { db, appId, userId, setDoc, doc, collection } = firebaseModule;

            if (!db) {
                 throw new Error('Database connection is not available.');
            }

            const purchaseInfo = {
                employeeCode: employeeCode,
                item: product.name,
                price: product.price,
                quantity: product.quantity || 1,
                transactionType: transactionType,
                date: new Date().toLocaleString('ko-KR', { hour12: false }),
                totalPrice: (parsePrice(product.price) * (product.quantity || 1)),
                userId: userId, 
                appId: appId
            };

            // íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ IDë¡œ ì‚¬ìš©
            const now = new Date();
            const timestamp = now.getFullYear() +
                             String(now.getMonth() + 1).padStart(2, '0') +
                             String(now.getDate()).padStart(2, '0') + '_' +
                             String(now.getHours()).padStart(2, '0') +
                             String(now.getMinutes()).padStart(2, '0') +
                             String(now.getSeconds()).padStart(2, '0') + '_' +
                             String(now.getMilliseconds()).padStart(3, '0');

            const path = `purchases`;
            const docRef = doc(db, path, timestamp);
            await setDoc(docRef, purchaseInfo);
            
            // Discord ì›¹í›… URL (ì—¬ê¸°ì— ë³¸ì¸ URL ì…ë ¥!)
            const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1470746418724601927/SFygmfQsiLSuLnYq0NBSeVJki7KiRnv4LRKYo3Tlm6Fi8rDEyOBrvPBht24ferjGsSqB";
            
            // Discord ì•Œë¦¼ ë³´ë‚´ê¸°
            try {
                // ì§ì› ì½”ë“œë¡œ ì´ë¦„ ì°¾ê¸°
                const employeeName = employeeNames[employeeCode] || "ë¯¸ë“±ë¡ ì§ì›";
                const displayName = employeeNames[employeeCode] 
                    ? `${employeeName} (\`${employeeCode}\`)` 
                    : `âš ï¸ ë¯¸ë“±ë¡ (\`${employeeCode}\`)`;
                
                await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [{
                            title: "ğŸ›’ ìƒˆë¡œìš´ êµ¬ë§¤ ë°œìƒ!",
                            color: 16744192,
                            fields: [
                                {
                                    name: "ğŸ‘¤ êµ¬ë§¤ì",
                                    value: displayName,
                                    inline: true
                                },
                                {
                                    name: "ğŸ“¦ ìƒí’ˆëª…",
                                    value: product.name,
                                    inline: true
                                },
                                {
                                    name: "ğŸ’° ë‹¨ê°€",
                                    value: product.price,
                                    inline: true
                                },
                                {
                                    name: "ğŸ“Š ìˆ˜ëŸ‰",
                                    value: `${purchaseInfo.quantity}ê°œ`,
                                    inline: true
                                },
                                {
                                    name: "ğŸ’µ ì´ ê¸ˆì•¡",
                                    value: `**${purchaseInfo.totalPrice.toLocaleString('ko-KR')} P**`,
                                    inline: true
                                },
                                {
                                    name: "ğŸ• êµ¬ë§¤ ì‹œê°„",
                                    value: purchaseInfo.date,
                                    inline: false
                                }
                            ],
                            footer: {
                                text: "ì˜¤ë Œì§€ ì£¼ì‹íšŒì‚¬ ì„ì§ì› ì‡¼í•‘ëª°"
                            },
                            timestamp: new Date().toISOString()
                        }]
                    })
                });
                console.log("âœ… Discord ì•Œë¦¼ ì „ì†¡ ì„±ê³µ!");
            } catch (error) {
                console.error("âŒ Discord ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨:", error);
            }
            
            console.log(`
âœ… êµ¬ë§¤ ì™„ë£Œ! - Firestore Doc ID: ${timestamp}
--------------------------------------------------
êµ¬ë§¤ì: ${employeeNames[employeeCode] || 'ë¯¸ë“±ë¡'} (${employeeCode})
êµ¬ë§¤ í’ˆëª©: ${product.name}
ìˆ˜ëŸ‰: ${purchaseInfo.quantity}
ì´ ê¸ˆì•¡: ${purchaseInfo.totalPrice.toLocaleString('ko-KR')} P
êµ¬ë§¤ ì‹œê°„: ${purchaseInfo.date}
--------------------------------------------------
`);
            return timestamp;
        }


      
        // ì¥ë°”êµ¬ë‹ˆ ì „ì²´ êµ¬ë§¤ í•¨ìˆ˜
        async function checkoutFromCart(employeeCode) {
            // UIë¥¼ ë¡œë”© ìƒíƒœë¡œ ë³€ê²½
            checkoutBtn.disabled = true;
            checkoutBtnText.textContent = "êµ¬ë§¤ ì§„í–‰ ì¤‘...";
            checkoutLoadingSpinner.classList.remove('hidden');
            
            try {
                // ì¥ë°”êµ¬ë‹ˆì— ìˆëŠ” ëª¨ë“  ì•„ì´í…œì— ëŒ€í•´ ê°œë³„ êµ¬ë§¤ ê¸°ë¡ì„ ì €ì¥ (Promise.allë¡œ ë³‘ë ¬ ì²˜ë¦¬)
                const savePromises = cart.map(item => savePurchase(item, employeeCode, 'cart'));
                await Promise.all(savePromises);
                
                // êµ¬ë§¤ ì„±ê³µ í›„ ì¥ë°”êµ¬ë‹ˆ ì´ˆê¸°í™”
                const totalItems = cart.length;
                cart = [];
                updateCartCount();
                renderCartItems(); 
                
                showMessage(`êµ¬ë§¤ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! (ì§ì› ì½”ë“œ: ${employeeCode}, ì´ ${totalItems}ê°œ)`);
                closeCartModal();

            } catch (error) {
                console.error("Cart checkout failed:", error);
                
                // ì—ëŸ¬ ë°œìƒ ì‹œ Firebase ì—°ê²° ìƒíƒœ ì¬í™•ì¸
                await initializeFirebaseConnection(); 

                if (!isFirebaseConnected) {
                     // ì¬ì‹œë„ í›„ì—ë„ ì—°ê²°ì´ ì‹¤íŒ¨í•œ ê²½ìš°
                     showErrorMessage('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨. ì¬ì—°ê²° ì‹œë„ í›„ ë‹¤ì‹œ í•´ ì£¼ì„¸ìš”.', checkoutErrorMessageId);
                } else {
                     // ì—°ê²°ì€ ëìœ¼ë‚˜ ì €ì¥ ì¤‘ì— ì˜¤ë¥˜ê°€ ë‚œ ê²½ìš°
                     showErrorMessage('ì „ì²´ êµ¬ë§¤ ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.', checkoutErrorMessageId);
                }

            } finally {
                // ìµœì¢…ì ìœ¼ë¡œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (initializeFirebaseConnectionì—ì„œ ì²˜ë¦¬ë¨)
                if (isFirebaseConnected) {
                     checkoutBtn.disabled = (cart.length === 0);
                     checkoutBtnText.textContent = "ì¥ë°”êµ¬ë‹ˆ ì „ì²´ êµ¬ë§¤ í™•ì •";
                     checkoutLoadingSpinner.classList.add('hidden');
                } else {
                     // ì—°ê²°ì´ ëŠê¸´ ìƒíƒœë¡œ ì¢…ë£Œ (ì¬ì—°ê²° ì‹œë„ ëª¨ë“œ)
                     checkoutBtn.disabled = false;
                     checkoutBtnText.textContent = "ì¬ì—°ê²° ì‹œë„";
                     checkoutLoadingSpinner.classList.add('hidden');
                }
            }
        }


        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒí’ˆ ëª©ë¡ ìƒì„± (Firebase ì—°ê²° í›„ í˜¸ì¶œë¨)
        window.onload = () => {
            updateCartCount(); // ì´ˆê¸° ì¹´ìš´íŠ¸ ì„¤ì •
            initializeFirebaseConnection(); // Firebase ì—°ê²° ì‹œì‘ (ì„±ê³µ ì‹œ renderProducts() í˜¸ì¶œ)
        };
    </script>
</body>
</html>




















