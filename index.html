<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간단 쇼핑몰 페이지</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Tailwind CSS를 사용하지만, 모달과 카드 특정 스타일은 여기서 정의 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f8f8;
            padding-bottom: 50px;
        }

        /* 상품 카드 스타일 */
        .product-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .product-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        /* 팝업 모달 스타일 */
        .modal {
            display: none; 
            position: fixed;
            z-index: 50; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6); 
        }

        .modal-content {
            background-color: #fff;
            margin: 10vh auto; 
            padding: 30px;
            border-radius: 12px;
            max-width: 440px; 
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }

        /* 구매 버튼 스타일 */
        #confirm-purchase-btn {
            background-color: #3b82f6; 
            transition: background-color 0.2s;
        }
        #confirm-purchase-btn:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body>

    <!-- 헤더 -->
    <header class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold text-gray-900 text-center">
                 오렌지 주식회사 임직원 쇼핑몰
            </h1>
        </div>
    </header>

    <!-- 상품 목록 -->
    <div id="product-list" class="max-w-7xl mx-auto mt-10 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 px-4">
        <!-- 상품 카드들이 여기에 동적으로 추가됩니다. -->
    </div>

    <!-- 구매 팝업 창 (모달) -->
    <div id="purchase-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content shadow-2xl">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2 id="modal-title" class="text-2xl font-semibold mb-4 text-gray-800">상품 구매 확정</h2>
            <p id="modal-product-name" class="text-lg font-medium mb-6 text-indigo-600"></p>
            
            <div class="mb-6 text-left">
                <label for="buyer-name" class="block text-sm font-medium text-gray-700 mb-2">
                    구매자 이름 입력:
                </label>
                <input type="text" id="buyer-name" placeholder="구매자 이름을 입력하세요" 
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            
            <button id="confirm-purchase-btn" 
                    class="w-full py-2 px-4 border border-transparent rounded-md text-white font-semibold shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                확인 (구매 진행)
            </button>

            <!-- 에러 메시지 표시 영역 -->
            <p id="error-message" class="text-red-500 text-sm mt-3 hidden">이름을 입력해야 구매할 수 있습니다.</p>
        </div>
    </div>

    <script>
        // "alert()" 대신 사용할 간단한 모달 메시지 함수
        function showMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-xl z-50 transition duration-300 ease-in-out';
            messageBox.textContent = message;
            document.body.appendChild(messageBox);
            setTimeout(() => {
                messageBox.remove();
            }, 3000);
        }

        function showErrorMessage(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function hideErrorMessage() {
            document.getElementById('error-message').classList.add('hidden');
        }


        // 1. 상품 데이터 정의
        const products = [
            { 
                id: 1, 
                name: "프리미엄 오렌지주스", 
                description: "무려 진짜 오렌지즙이 1%나 함유된 프리미엄 오렌지 주스다. 웰몬트의 효자 상품. 오염도 -20%", 
                price: "500P", 
                image: "https://cdn.discordapp.com/attachments/1428005198143688714/1438515462383075478/d842b46950944d07.png?ex=6917296c&is=6915d7ec&hm=bec868bc297693e6c669148b0455921e45448abab7b48ba6e87216861e3dcc74" 
            },
            { 
                id: 2, 
                name: "오렌지주스", 
                description: "어디서나 볼 수 있는 흔한 오렌지 주스. 설탕 함유량이 높다. 오염도 -10%", 
                price: "200P", 
                image: "https://cdn.discordapp.com/attachments/1394056401088679966/1438570414912569576/KakaoTalk_20251110_094656257.png?ex=69175c9a&is=69160b1a&hm=632767b34082852c5c64f6e222cde210b79da22aeae91d857c23ef55c4d98227" 
            },
            { 
                id: 3, 
                name: "필름 카메라", 
                description: "딱 한 장 필름이 남아있는 낡은 카메라다. 원하는 사람들을 찍거나 함께 사진을 한 장 남길 수 있다. (인화는 팀장에게 문의하도록!)", 
                price: "3000P", 
                image: "https://cdn.discordapp.com/attachments/1394056401088679966/1438571013905449030/KakaoTalk_20251110_094656257_01.png?ex=69175d29&is=69160ba9&hm=0ef2d5ba3515fd469632543a6e458414b238fd00e63e755697980e1562016a80" 
            },
            { 
                id: 4, 
                name: "랜덤박스", 
                description: "로봇이 돌려주는 1,000p 랜덤 박스. 상점 아이템 중 랜덤한 물건을 증정! * 히든 아이템 존재 *", 
                price: "1000P", 
                image: "https://cdn.discordapp.com/attachments/1394056401088679966/1438571437332893827/6935302d628b746b.png?ex=69175d8e&is=69160c0e&hm=f06d8eafe27214997322d4fe874ff346c3f9240ba35cd36af522a315df6f049b" 
            },
            { 
                id: 5, 
                name: "미정", 
                description: "미정", 
                price: "미정", 
                image: "https://images.unsplash.com/photo-1603597818464-96657958b4b2?w=400&h=400&fit=crop" 
            }
        ];

        // 구매 내역을 저장할 배열 (실제 데이터베이스 역할)
        let purchaseHistory = [];

        const productList = document.getElementById('product-list');
        const modal = document.getElementById('purchase-modal');
        const modalProductName = document.getElementById('modal-product-name');
        const confirmPurchaseBtn = document.getElementById('confirm-purchase-btn');
        const buyerNameInput = document.getElementById('buyer-name');

        let selectedProductId = null; // 현재 선택된 상품 ID

        // 2. 상품 목록 동적 생성 함수
        function renderProducts() {
            productList.innerHTML = ''; // 초기화
            products.forEach(product => {
                const card = document.createElement('div');
                card.classList.add('product-card', 'bg-white', 'rounded-xl', 'overflow-hidden', 'shadow-lg');
                card.setAttribute('data-product-id', product.id);

                card.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="p-5 text-center">
                        <p class="text-lg font-semibold text-gray-800 product-name">${product.name}</p>
                        <p class="text-sm text-gray-500 mb-2 product-description">${product.description}</p>
                        <p class="text-xl font-bold text-red-500 product-price">${product.price}</p>
                    </div>
                `;
                
                // 이미지나 상품명을 클릭하면 팝업 열기
                card.addEventListener('click', () => {
                    openModal(product);
                });

                productList.appendChild(card);
            });
        }

        // 3. 팝업 창 열기 함수
        function openModal(product) {
            selectedProductId = product.id;
            modalProductName.textContent = `[${product.name}]을(를) 구매하시겠습니까? (가격: ${product.price})`;
            buyerNameInput.value = ''; 
            hideErrorMessage(); // 에러 메시지 초기화
            modal.style.display = 'block';
            buyerNameInput.focus(); // 입력창에 포커스
        }

        // 4. 팝업 창 닫기 함수
        function closeModal() {
            modal.style.display = 'none';
            selectedProductId = null;
            hideErrorMessage();
        }

        // 5. 팝업 외부 클릭 및 닫기 버튼 설정
        window.onclick = (event) => {
            if (event.target == modal) {
                closeModal();
            }
        };

        // 6. 구매 확인 버튼 클릭 이벤트
        confirmPurchaseBtn.addEventListener('click', () => {
            const buyerName = buyerNameInput.value.trim();

            if (!buyerName) {
                showErrorMessage('이름을 입력해야 구매할 수 있습니다.');
                return;
            }
            
            hideErrorMessage();

            if (selectedProductId !== null) {
                const purchasedProduct = products.find(p => p.id === selectedProductId);

                const purchaseInfo = {
                    buyer: buyerName,
                    item: purchasedProduct.name,
                    price: purchasedProduct.price,
                    date: new Date().toLocaleString('ko-KR', { hour12: false })
                };

                // 구매 정보 저장 (배열에 추가)
                purchaseHistory.push(purchaseInfo);
                
                // 저장된 정보를 콘솔에 출력 (데이터 저장 확인)
                console.log('✅ 구매 완료! (구매자/품목 정보 저장됨)');
                console.log('--- 최종 구매 내역 ---');
                console.log(purchaseInfo);
                console.log('--- 전체 구매 기록 ---');
                console.table(purchaseHistory); // 표 형태로 출력하여 확인 용이
                console.log('--------------------------');

                // 사용자에게 완료 메시지 표시
                showMessage(`${buyerName}님, ${purchasedProduct.name} 구매가 완료되었습니다!`);
                closeModal();
            }
        });

        // 엔터 키로 구매 확인
        buyerNameInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // 기본 폼 제출 방지
                confirmPurchaseBtn.click();
            }
        });


        // 페이지 로드 시 상품 목록 생성
        window.onload = renderProducts;

    </script>
</body>
</html>